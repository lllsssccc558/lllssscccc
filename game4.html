<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>記憶配對遊戲</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            color: #fff;
        }
        
        .container {
            max-width: 1200px;
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            width: 100%;
        }
        
        h1 {
            font-size: 3.5rem;
            margin-bottom: 10px;
            text-shadow: 3px 3px 6px rgba(0, 0, 0, 0.5);
            background: linear-gradient(45deg, #ffd700, #ff8c00);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }
        
        .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
            margin-bottom: 20px;
        }
        
        .game-info {
            display: flex;
            justify-content: space-between;
            width: 90%;
            max-width: 800px;
            background-color: rgba(0, 0, 0, 0.3);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
        }
        
        .info-box {
            text-align: center;
            flex: 1;
            margin: 0 10px;
        }
        
        .info-title {
            font-size: 1rem;
            color: #ffcc00;
            margin-bottom: 8px;
            display: block;
        }
        
        .info-value {
            font-size: 2rem;
            font-weight: bold;
            color: white;
        }
        
        .controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 30px;
            width: 90%;
            max-width: 800px;
            flex-wrap: wrap;
        }
        
        .difficulty-selector {
            display: flex;
            gap: 10px;
            background-color: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 15px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        
        .difficulty-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 50px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            color: white;
        }
        
        .easy {
            background-color: #4CAF50;
        }
        
        .medium {
            background-color: #FF9800;
        }
        
        .hard {
            background-color: #F44336;
        }
        
        .difficulty-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        .difficulty-btn.active {
            transform: scale(1.05);
            box-shadow: 0 0 15px rgba(255, 255, 255, 0.5);
        }
        
        .game-buttons {
            display: flex;
            gap: 10px;
        }
        
        .control-btn {
            padding: 12px 25px;
            border: none;
            border-radius: 50px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            color: white;
        }
        
        .start-btn {
            background-color: #2196F3;
        }
        
        .reset-btn {
            background-color: #9C27B0;
        }
        
        .control-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        .game-board {
            display: grid;
            grid-gap: 15px;
            margin: 0 auto 40px;
            perspective: 1000px;
        }
        
        .card {
            width: 100px;
            height: 100px;
            position: relative;
            transform-style: preserve-3d;
            transition: transform 0.6s;
            cursor: pointer;
            border-radius: 10px;
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2);
        }
        
        .card.flipped {
            transform: rotateY(180deg);
        }
        
        .card-front, .card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            border-radius: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 2.5rem;
        }
        
        .card-front {
            background: linear-gradient(45deg, #1a2a6c, #4A00E0);
            color: white;
            transform: rotateY(180deg);
        }
        
        .card-back {
            background: linear-gradient(45deg, #1a1a2e, #16213e);
            color: rgba(255, 255, 255, 0.1);
            border: 3px solid rgba(255, 255, 255, 0.1);
        }
        
        .card-back i {
            color: rgba(255, 255, 255, 0.2);
        }
        
        .matched .card-front {
            background: linear-gradient(45deg, #00b09b, #96c93d);
            box-shadow: 0 0 15px rgba(0, 176, 155, 0.7);
        }
        
        .high-scores {
            background-color: rgba(0, 0, 0, 0.3);
            padding: 25px;
            border-radius: 15px;
            width: 90%;
            max-width: 800px;
            margin-bottom: 40px;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
        }
        
        .high-scores h2 {
            text-align: center;
            margin-bottom: 20px;
            color: #ffcc00;
            font-size: 1.8rem;
        }
        
        .score-list {
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
        }
        
        .score-item {
            text-align: center;
            margin: 10px;
            padding: 15px;
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            min-width: 150px;
        }
        
        .score-difficulty {
            font-size: 1.2rem;
            color: #4fc3f7;
            margin-bottom: 8px;
        }
        
        .score-value {
            font-size: 2rem;
            font-weight: bold;
            color: white;
        }
        
        .game-over, .game-win {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.85);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 100;
            display: none;
        }
        
        .message-box {
            background: linear-gradient(135deg, #1a2a6c, #b21f1f);
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.5);
            animation: popIn 0.5s ease-out;
        }
        
        @keyframes popIn {
            0% { transform: scale(0.7); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }
        
        .message-box h2 {
            font-size: 2.5rem;
            margin-bottom: 20px;
            color: #ffcc00;
        }
        
        .message-box p {
            font-size: 1.2rem;
            margin-bottom: 25px;
            line-height: 1.6;
        }
        
        .message-box button {
            padding: 15px 30px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 50px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .message-box button:hover {
            background-color: #45a049;
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        footer {
            text-align: center;
            padding: 20px;
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.9rem;
            width: 100%;
        }
        
        @media (max-width: 768px) {
            h1 {
                font-size: 2.5rem;
            }
            
            .game-info {
                flex-direction: column;
                gap: 15px;
            }
            
            .controls {
                flex-direction: column;
                align-items: center;
            }
            
            .card {
                width: 80px;
                height: 80px;
            }
            
            .card-front, .card-back {
                font-size: 2rem;
            }
        }
        
        @media (max-width: 480px) {
            .card {
                width: 70px;
                height: 70px;
            }
            
            .card-front, .card-back {
                font-size: 1.8rem;
            }
            
            .difficulty-selector {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-brain"></i> 記憶配對遊戲</h1>
            <p class="subtitle">翻開卡片找到所有匹配的圖案，挑戰你的記憶力！</p>
        </header>
        
        <div class="game-info">
            <div class="info-box">
                <span class="info-title">時間</span>
                <span class="info-value" id="timer">00:00</span>
            </div>
            <div class="info-box">
                <span class="info-title">步數</span>
                <span class="info-value" id="moves">0</span>
            </div>
            <div class="info-box">
                <span class="info-title">分數</span>
                <span class="info-value" id="score">0</span>
            </div>
            <div class="info-box">
                <span class="info-title">剩餘配對</span>
                <span class="info-value" id="matches-left">0</span>
            </div>
        </div>
        
        <div class="controls">
            <div class="difficulty-selector">
                <button class="difficulty-btn easy active" data-difficulty="easy">簡單 (4x4)</button>
                <button class="difficulty-btn medium" data-difficulty="medium">中等 (4x5)</button>
                <button class="difficulty-btn hard" data-difficulty="hard">困難 (5x6)</button>
            </div>
            
            <div class="game-buttons">
                <button class="control-btn start-btn" id="start-btn">
                    <i class="fas fa-play"></i> 開始遊戲
                </button>
                <button class="control-btn reset-btn" id="reset-btn">
                    <i class="fas fa-redo"></i> 重新開始
                </button>
            </div>
        </div>
        
        <div class="game-board" id="game-board">
            <!-- 卡片將由 JavaScript 動態生成 -->
        </div>
        
        <div class="high-scores">
            <h2><i class="fas fa-trophy"></i> 最高分記錄</h2>
            <div class="score-list">
                <div class="score-item">
                    <div class="score-difficulty">簡單</div>
                    <div class="score-value" id="high-score-easy">0</div>
                </div>
                <div class="score-item">
                    <div class="score-difficulty">中等</div>
                    <div class="score-value" id="high-score-medium">0</div>
                </div>
                <div class="score-item">
                    <div class="score-difficulty">困難</div>
                    <div class="score-value" id="high-score-hard">0</div>
                </div>
            </div>
        </div>
        
        <div class="game-over" id="game-over">
            <div class="message-box">
                <h2>遊戲結束</h2>
                <p>時間到了！你未能完成所有配對。</p>
                <p>你的分數: <span id="final-score">0</span></p>
                <button id="retry-btn">再試一次</button>
            </div>
        </div>
        
        <div class="game-win" id="game-win">
            <div class="message-box">
                <h2>恭喜你！</h2>
                <p>你成功完成了所有配對！</p>
                <p>用時: <span id="win-time">00:00</span> | 步數: <span id="win-moves">0</span></p>
                <p>分數: <span id="win-score">0</span></p>
                <button id="play-again-btn">再玩一次</button>
            </div>
        </div>
        
        <footer>
            <p>記憶配對遊戲 &copy; 2023 | 使用 HTML5, CSS3 和 JavaScript 製作</p>
        </footer>
    </div>

    <script>
        // 遊戲變數
        let gameStarted = false;
        let timer = 0;
        let timerInterval;
        let moves = 0;
        let score = 0;
        let flippedCards = [];
        let matchedPairs = 0;
        let totalPairs = 0;
        let currentDifficulty = 'easy';
        
        // 難度設置
        const difficulties = {
            easy: { rows: 4, cols: 4, timeLimit: 120 }, // 4x4 = 8對卡片
            medium: { rows: 4, cols: 5, timeLimit: 150 }, // 4x5 = 10對卡片
            hard: { rows: 5, cols: 6, timeLimit: 180 } // 5x6 = 15對卡片
        };
        
        // 卡片圖標
        const cardIcons = [
            'fas fa-heart', 'fas fa-star', 'fas fa-moon', 'fas fa-sun',
            'fas fa-cloud', 'fas fa-bolt', 'fas fa-gem', 'fas fa-bell',
            'fas fa-flag', 'fas fa-key', 'fas fa-crown', 'fas fa-rocket',
            'fas fa-tree', 'fas fa-umbrella', 'fas fa-snowflake', 'fas fa-football-ball',
            'fas fa-basketball-ball', 'fas fa-music', 'fas fa-camera', 'fas fa-gift'
        ];
        
        // 從 localStorage 加載最高分
        let highScores = {
            easy: localStorage.getItem('memoryHighScoreEasy') || 0,
            medium: localStorage.getItem('memoryHighScoreMedium') || 0,
            hard: localStorage.getItem('memoryHighScoreHard') || 0
        };
        
        // DOM 元素
        const gameBoard = document.getElementById('game-board');
        const timerElement = document.getElementById('timer');
        const movesElement = document.getElementById('moves');
        const scoreElement = document.getElementById('score');
        const matchesLeftElement = document.getElementById('matches-left');
        const startBtn = document.getElementById('start-btn');
        const resetBtn = document.getElementById('reset-btn');
        const difficultyBtns = document.querySelectorAll('.difficulty-btn');
        const gameOverScreen = document.getElementById('game-over');
        const gameWinScreen = document.getElementById('game-win');
        const finalScoreElement = document.getElementById('final-score');
        const winTimeElement = document.getElementById('win-time');
        const winMovesElement = document.getElementById('win-moves');
        const winScoreElement = document.getElementById('win-score');
        const retryBtn = document.getElementById('retry-btn');
        const playAgainBtn = document.getElementById('play-again-btn');
        const highScoreEasyElement = document.getElementById('high-score-easy');
        const highScoreMediumElement = document.getElementById('high-score-medium');
        const highScoreHardElement = document.getElementById('high-score-hard');
        
        // 初始化遊戲
        function initGame() {
            // 重置遊戲狀態
            gameStarted = false;
            clearInterval(timerInterval);
            timer = 0;
            moves = 0;
            score = 0;
            flippedCards = [];
            matchedPairs = 0;
            
            // 更新顯示
            updateDisplay();
            
            // 清空遊戲板
            gameBoard.innerHTML = '';
            
            // 根據難度創建卡片
            const { rows, cols } = difficulties[currentDifficulty];
            totalPairs = (rows * cols) / 2;
            
            // 創建卡片陣列
            let cards = [];
            const icons = cardIcons.slice(0, totalPairs);
            
            // 每種圖標需要兩張卡片
            icons.forEach(icon => {
                cards.push({ icon, matched: false });
                cards.push({ icon, matched: false });
            });
            
            // 洗牌
            cards = shuffleArray(cards);
            
            // 設置遊戲板網格
            gameBoard.style.gridTemplateColumns = `repeat(${cols}, 1fr)`;
            gameBoard.style.gridTemplateRows = `repeat(${rows}, 1fr)`;
            
            // 創建卡片元素
            cards.forEach((card, index) => {
                const cardElement = document.createElement('div');
                cardElement.className = 'card';
                cardElement.dataset.index = index;
                
                cardElement.innerHTML = `
                    <div class="card-front">
                        <i class="${card.icon}"></i>
                    </div>
                    <div class="card-back">
                        <i class="fas fa-question"></i>
                    </div>
                `;
                
                cardElement.addEventListener('click', () => flipCard(cardElement, index));
                gameBoard.appendChild(cardElement);
            });
            
            // 更新剩餘配對數
            matchesLeftElement.textContent = totalPairs;
            
            // 更新最高分顯示
            updateHighScoresDisplay();
        }
        
        // 洗牌函數
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }
        
        // 開始遊戲
        function startGame() {
            if (gameStarted) return;
            
            gameStarted = true;
            
            // 啟動計時器
            timerInterval = setInterval(() => {
                timer++;
                updateTimerDisplay();
                
                // 檢查時間是否用盡
                const timeLimit = difficulties[currentDifficulty].timeLimit;
                if (timer >= timeLimit) {
                    endGame(false);
                }
                
                // 每過10秒扣一點分數（增加挑戰性）
                if (timer % 10 === 0 && timer > 0) {
                    score = Math.max(0, score - 5);
                    updateScore();
                }
            }, 1000);
            
            // 更新按鈕狀態
            startBtn.innerHTML = '<i class="fas fa-pause"></i> 遊戲進行中';
            startBtn.style.backgroundColor = '#FF9800';
        }
        
        // 翻轉卡片
        function flipCard(cardElement, index) {
            // 如果遊戲未開始或卡片已匹配或已翻開，則忽略點擊
            if (!gameStarted || cardElement.classList.contains('flipped') || cardElement.classList.contains('matched')) {
                return;
            }
            
            // 如果已經有兩張翻開的卡片，則忽略點擊
            if (flippedCards.length >= 2) {
                return;
            }
            
            // 翻開卡片
            cardElement.classList.add('flipped');
            flippedCards.push({ element: cardElement, index });
            
            // 如果翻開了兩張卡片，檢查是否匹配
            if (flippedCards.length === 2) {
                moves++;
                movesElement.textContent = moves;
                
                const card1 = flippedCards[0].element.querySelector('.card-front i').className;
                const card2 = flippedCards[1].element.querySelector('.card-front i').className;
                
                if (card1 === card2) {
                    // 匹配成功
                    setTimeout(() => {
                        flippedCards.forEach(card => {
                            card.element.classList.add('matched');
                        });
                        
                        flippedCards = [];
                        matchedPairs++;
                        matchesLeftElement.textContent = totalPairs - matchedPairs;
                        
                        // 計算分數
                        calculateScore(true);
                        
                        // 檢查是否贏得遊戲
                        if (matchedPairs === totalPairs) {
                            endGame(true);
                        }
                    }, 500);
                } else {
                    // 匹配失敗
                    setTimeout(() => {
                        flippedCards.forEach(card => {
                            card.element.classList.remove('flipped');
                        });
                        
                        flippedCards = [];
                        
                        // 計算分數
                        calculateScore(false);
                    }, 1000);
                }
            }
        }
        
        // 計算分數
        function calculateScore(isMatch) {
            if (isMatch) {
                // 匹配成功：基礎分 + 時間獎勵 + 步數獎勵
                let basePoints = 100;
                let timeBonus = Math.max(0, 50 - Math.floor(timer / 5));
                let movesBonus = Math.max(0, 30 - moves / 10);
                
                score += basePoints + timeBonus + movesBonus;
            } else {
                // 匹配失敗：扣分
                score = Math.max(0, score - 20);
            }
            
            updateScore();
        }
        
        // 更新分數顯示
        function updateScore() {
            scoreElement.textContent = Math.round(score);
        }
        
        // 更新計時器顯示
        function updateTimerDisplay() {
            const minutes = Math.floor(timer / 60);
            const seconds = timer % 60;
            timerElement.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }
        
        // 更新所有顯示
        function updateDisplay() {
            updateTimerDisplay();
            movesElement.textContent = moves;
            scoreElement.textContent = Math.round(score);
        }
        
        // 結束遊戲
        function endGame(isWin) {
            gameStarted = false;
            clearInterval(timerInterval);
            
            if (isWin) {
                // 贏得遊戲
                winTimeElement.textContent = timerElement.textContent;
                winMovesElement.textContent = moves;
                winScoreElement.textContent = Math.round(score);
                
                // 檢查是否為新的最高分
                if (score > highScores[currentDifficulty]) {
                    highScores[currentDifficulty] = Math.round(score);
                    localStorage.setItem(`memoryHighScore${capitalizeFirstLetter(currentDifficulty)}`, Math.round(score));
                    updateHighScoresDisplay();
                }
                
                gameWinScreen.style.display = 'flex';
            } else {
                // 遊戲結束
                finalScoreElement.textContent = Math.round(score);
                gameOverScreen.style.display = 'flex';
            }
        }
        
        // 更新最高分顯示
        function updateHighScoresDisplay() {
            highScoreEasyElement.textContent = Math.round(highScores.easy);
            highScoreMediumElement.textContent = Math.round(highScores.medium);
            highScoreHardElement.textContent = Math.round(highScores.hard);
        }
        
        // 首字母大寫函數
        function capitalizeFirstLetter(string) {
            return string.charAt(0).toUpperCase() + string.slice(1);
        }
        
        // 事件監聽器
        startBtn.addEventListener('click', () => {
            if (!gameStarted) {
                startGame();
            }
        });
        
        resetBtn.addEventListener('click', initGame);
        
        difficultyBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                // 更新活動按鈕
                difficultyBtns.forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                
                // 更新難度
                currentDifficulty = btn.dataset.difficulty;
                
                // 重新初始化遊戲
                initGame();
            });
        });
        
        retryBtn.addEventListener('click', () => {
            gameOverScreen.style.display = 'none';
            initGame();
            startGame();
        });
        
        playAgainBtn.addEventListener('click', () => {
            gameWinScreen.style.display = 'none';
            initGame();
            startGame();
        });
        
        // 初始化遊戲和最高分顯示
        initGame();
        updateHighScoresDisplay();
    </script>
</body>
</html>